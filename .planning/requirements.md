# 需求分析文档

## 1. 问题背景

使用CLI AI工具（如Claude Code、GitHub Copilot CLI）时，这些工具经常会提示用户确认执行某个命令。用户需要理解命令的含义和潜在风险才能做出决策，但：
- 许多命令语法复杂，不易理解
- 用户需要借助其他AI工具来解释命令，效率低下
- 缺乏统一的风险评估标准

## 2. 目标用户

- 使用AI CLI工具的开发者
- 对命令行不够熟悉的用户
- 关注安全性的技术人员

## 3. 功能需求

### 3.1 核心功能

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 命令捕获 | 通过快捷键+剪贴板捕获命令 | P0 |
| 命令解析 | 解析命令结构、参数、选项 | P0 |
| 命令解释 | 使用AI解释命令的作用 | P0 |
| 风险评估 | 评估命令的潜在风险等级 | P0 |
| 结果展示 | 以友好方式展示解释结果 | P1 |

### 3.2 命令识别需求（v1.1新增）

| 需求 | 描述 | 优先级 |
|------|------|--------|
| 广泛命令覆盖 | 识别150+常用命令 | P0 |
| 自定义命令支持 | 支持用户配置自定义命令列表 | P1 |
| 命令别名支持 | 支持命令别名映射（如 k→kubectl） | P2 |
| 智能识别 | 避免误判普通文本为命令 | P0 |

**命令覆盖范围**：
- 系统管理：sudo, systemctl, service 等
- 包管理：apt, yum, brew, npm 等
- 开发工具：git, docker, kubectl 等
- 文件操作：ls, rm, cp, mv 等
- 网络工具：curl, wget, ssh 等
- 防火墙/安全：ufw, iptables 等
- 编辑器：vim, nano, code 等
- 数据库：mysql, psql, mongo 等
- **用户自定义**：项目特定命令、脚本

### 3.3 命令解释内容

解释应包含：
1. **命令概述**：一句话说明命令做什么
2. **详细解释**：逐参数解释
3. **影响范围**：命令会影响哪些文件/系统
4. **风险等级**：低/中/高/严重
5. **风险说明**：具体的潜在风险
6. **执行建议**：是否推荐执行

### 3.4 风险评估维度

| 维度 | 低风险 | 中风险 | 高风险 | 严重风险 |
|------|--------|--------|--------|---------|
| 文件操作 | 读取 | 创建/修改 | 删除单个 | 批量删除/rm -rf |
| 系统操作 | 查看 | 安装软件 | 修改配置 | 修改权限/root操作 |
| 网络操作 | 本地请求 | 下载文件 | 上传数据 | 暴露敏感信息 |
| 不可逆性 | 可撤销 | 部分可逆 | 难以恢复 | 不可逆 |

### 3.5 UI交互需求（v1.1新增）

| 需求 | 描述 | 优先级 |
|------|------|--------|
| 执行确认 | 展示解释后提供 [Y/N] 确认选项 | P1 |
| 分级显示 | 根据风险等级调整展示详细程度 | P2 |
| 多种展示模式 | 支持终端内联/GUI弹窗等模式 | P2 |

## 4. 非功能需求

### 4.1 性能要求
- 命令解释响应时间 < 3秒
- 命令识别响应时间 < 100ms
- 低资源占用，不影响主终端性能

### 4.2 可用性要求
- 简单的安装和配置
- 清晰的输出格式
- 支持中英文解释
- **配置文件易读易写**（YAML格式）
- **向后兼容**（新增配置项提供默认值）

### 4.3 兼容性要求
- 支持Windows PowerShell
- 支持Windows Terminal
- 支持常见终端模拟器
- Python 3.9+

### 4.4 可配置性要求（v1.1新增）

用户应能通过配置文件自定义：
- 自定义命令列表
- 命令别名映射
- AI服务提供商
- 展示模式
- 快捷键

## 5. 技术约束

- **最小依赖**：尽量减少外部依赖
- **可扩展性**：支持添加新的命令识别方式
- **隐私安全**：命令内容仅发送给可信AI服务
- **离线降级**：AI服务不可用时提供基础解释

## 6. 改进历史

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| v1.0 | 2026-01 | 初始需求 |
| v1.1 | 2026-01-30 | 补充命令识别和可配置性需求 |
